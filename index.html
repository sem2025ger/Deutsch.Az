<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Транскрибация и Озвучка Видео</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            slate: { 850: '#1e293b', 900: '#0f172a', 950: '#020617' }
          }
        }
      }
    }
  </script>

  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    .dark ::-webkit-scrollbar-thumb { background: #475569; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    .animate-spin-custom { animation: spin 1s linear infinite; }
  </style>
</head>

<body class="bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 transition-colors">
  <div id="app" class="min-h-screen p-4 md:p-8">
    <div class="max-w-6xl mx-auto">

      <header class="text-center mb-8 relative">
        <div class="absolute right-0 top-0 flex gap-2">
          <button id="btn-theme" class="p-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700">
            <i data-lucide="moon" class="w-4 h-4" id="icon-dark"></i>
            <i data-lucide="sun" class="w-4 h-4 hidden" id="icon-light"></i>
          </button>
        </div>
        <div class="inline-flex p-3 bg-indigo-600 rounded-2xl shadow-lg mb-4">
          <i data-lucide="mic" class="w-8 h-8 text-white"></i>
        </div>
        <h1 class="text-3xl font-bold text-slate-800 dark:text-white">Транскрибация и Озвучка</h1>
        <p class="text-slate-500 dark:text-slate-400 mt-2">Перевод с немецкого на русский</p>
      </header>

      <div class="max-w-lg mx-auto mb-8 p-4 bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700">
        <div class="flex items-center justify-between mb-2">
          <label class="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase">
            <i data-lucide="key" class="w-3 h-3 inline"></i> API Key
          </label>
          <span id="key-status" class="text-xs text-slate-400">Не сохранён</span>
        </div>
        <div class="flex gap-2">
          <input type="password" id="api-key" placeholder="Gemini API Key"
            class="flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
          <button id="btn-save-key" class="px-4 py-2 bg-slate-800 dark:bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-slate-700 dark:hover:bg-indigo-500">
            Сохранить
          </button>
        </div>
        <p class="text-xs text-slate-400 mt-2">Ключ сохраняется в localStorage браузера</p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">

        <div class="lg:col-span-5 space-y-4">
          <div id="upload-area" class="border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-2xl p-6 bg-white dark:bg-slate-800 min-h-[400px] flex flex-col">

            <label id="upload-label" class="flex flex-col items-center justify-center cursor-pointer flex-1">
              <i data-lucide="upload" class="w-12 h-12 text-slate-300 dark:text-slate-600 mb-4"></i>
              <span class="text-sm font-medium text-slate-600 dark:text-slate-400">Выберите видео (макс. 20MB)</span>
              <input type="file" id="file-input" class="hidden" accept="video/*">
            </label>

            <div id="file-info" class="hidden flex-col flex-1 space-y-4">
              <div class="flex justify-between items-center">
                <p class="text-xs font-bold text-slate-400 uppercase">Файл выбран</p>
                <button id="btn-remove" class="p-1 hover:bg-slate-100 dark:hover:bg-slate-700 rounded">
                  <i data-lucide="x" class="w-4 h-4 text-slate-400"></i>
                </button>
              </div>
              <div class="flex items-start gap-3">
                <div class="p-2 bg-indigo-100 dark:bg-indigo-900/40 rounded-lg">
                  <i data-lucide="file-video" class="w-5 h-5 text-indigo-600 dark:text-indigo-400"></i>
                </div>
                <div class="flex-1 min-w-0">
                  <p id="file-name" class="text-sm font-medium text-slate-700 dark:text-slate-300 truncate"></p>
                  <p id="file-size" class="text-xs text-slate-400"></p>
                </div>
              </div>
              <div class="bg-slate-900 rounded-xl overflow-hidden flex-1 flex items-center justify-center">
                <video id="video-preview" class="w-full h-full object-contain" controls></video>
              </div>
              <button id="btn-transcribe" class="w-full py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-semibold rounded-xl shadow-lg">
                <span class="flex items-center justify-center gap-2">
                  <i data-lucide="sparkles" class="w-5 h-5"></i>
                  <span>Транскрибировать</span>
                </span>
              </button>
            </div>

            <div id="processing" class="hidden flex-col items-center justify-center flex-1">
              <div class="relative w-16 h-16 mb-4">
                <div class="absolute inset-0 border-4 border-slate-200 dark:border-slate-700 rounded-full"></div>
                <div class="absolute inset-0 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin-custom"></div>
              </div>
              <p id="process-text" class="text-sm text-slate-600 dark:text-slate-400 font-medium"></p>
            </div>
          </div>
        </div>

        <div class="lg:col-span-7 space-y-4">

          <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-slate-200 dark:border-slate-700">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-lg font-bold text-slate-700 dark:text-slate-200 flex items-center gap-2">
                <i data-lucide="text" class="w-5 h-5 text-slate-400"></i>
                Транскрипция (DE)
              </h2>
              <button id="btn-copy-src" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg disabled:opacity-30" disabled>
                <i data-lucide="copy" class="w-4 h-4 text-slate-400"></i>
              </button>
            </div>
            <div class="bg-slate-50 dark:bg-slate-900 rounded-xl p-4 min-h-[200px] max-h-[300px] overflow-y-auto border border-slate-200 dark:border-slate-700">
              <p id="transcription-text" class="text-sm text-slate-400 dark:text-slate-600 italic">Результат появится здесь...</p>
            </div>
            <div class="mt-4 space-y-3">
              <div class="flex gap-2">
                <label class="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase flex-shrink-0 pt-2">Голос (DE)</label>
                <select id="voice-de" class="flex-1 px-2 py-1 text-xs border border-slate-300 dark:border-slate-600 dark:bg-slate-700 rounded-lg">
                  <option value="de-DE-FlorianMultilingualNeural">Немецкий (Florian)</option>
                  <option value="de-DE-SeraphinaMultilingualNeural">Немецкий (Seraphina)</option>
                  <option value="de-DE-ConradNeural">Немецкий (Conrad)</option>
                  <option value="de-DE-KatjaNeural">Немецкий (Katja)</option>
                </select>
              </div>
              <button id="btn-speak-de" class="w-full py-2.5 bg-emerald-500 hover:bg-emerald-600 text-white font-medium rounded-lg disabled:bg-slate-300 dark:disabled:bg-slate-700 disabled:cursor-not-allowed" disabled>
                <span class="flex items-center justify-center gap-2">
                  <i data-lucide="volume-2" class="w-4 h-4" id="icon-speak-de"></i>
                  <i data-lucide="loader-2" class="w-4 h-4 hidden animate-spin-custom" id="loader-de"></i>
                  <span id="text-speak-de">Озвучить (DE)</span>
                </span>
              </button>
            </div>
          </div>

          <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-slate-200 dark:border-slate-700">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-lg font-bold text-slate-700 dark:text-slate-200 flex items-center gap-2">
                <i data-lucide="languages" class="w-5 h-5 text-slate-400"></i>
                Перевод (RU)
              </h2>
              <button id="btn-copy-ru" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg disabled:opacity-30" disabled>
                <i data-lucide="copy" class="w-4 h-4 text-slate-400"></i>
              </button>
            </div>
            <div class="bg-slate-50 dark:bg-slate-900 rounded-xl p-4 min-h-[200px] max-h-[300px] overflow-y-auto border border-slate-200 dark:border-slate-700">
              <p id="translation-text" class="text-sm text-slate-400 dark:text-slate-600 italic">Результат появится здесь...</p>
            </div>
            <div class="mt-4 space-y-3">
              <div class="flex gap-2">
                <label class="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase flex-shrink-0 pt-2">Голос (RU)</label>
                <select id="voice-ru" class="flex-1 px-2 py-1 text-xs border border-slate-300 dark:border-slate-600 dark:bg-slate-700 rounded-lg">
                  <option value="ru-RU-DmitryNeural">Русский (Дмитрий)</option>
                  <option value="ru-RU-SvetlanaNeural">Русский (Светлана)</option>
                  <option value="ru-RU-DariyaNeural">Русский (Дария)</option>
                </select>
              </div>
              <button id="btn-speak-ru" class="w-full py-2.5 bg-emerald-500 hover:bg-emerald-600 text-white font-medium rounded-lg disabled:bg-slate-300 dark:disabled:bg-slate-700 disabled:cursor-not-allowed" disabled>
                <span class="flex items-center justify-center gap-2">
                  <i data-lucide="volume-2" class="w-4 h-4" id="icon-speak-ru"></i>
                  <i data-lucide="loader-2" class="w-4 h-4 hidden animate-spin-custom" id="loader-ru"></i>
                  <span id="text-speak-ru">Озвучить (RU)</span>
                </span>
              </button>
            </div>
          </div>

        </div>
      </div>

      <footer class="mt-12 text-center text-xs text-slate-400">
        <p>Транскрибация: <strong>Gemini API</strong> • Озвучка: <strong>Edge-TTS</strong></p>
      </footer>

    </div>
  </div>

  <script>
    lucide.createIcons();

    const state = {
      apiKey: localStorage.getItem('gemini-api-key') || '',
      file: null,
      transcription: '',
      translation: '',
      isDark: localStorage.getItem('theme') === 'dark',
      currentAudio: null,
      isSpeaking: false
    };

    const $ = (id) => document.getElementById(id);
    const els = {
      apiKey: $('api-key'),
      btnSaveKey: $('btn-save-key'),
      keyStatus: $('key-status'),
      btnTheme: $('btn-theme'),
      iconDark: $('icon-dark'),
      iconLight: $('icon-light'),
      fileInput: $('file-input'),
      uploadLabel: $('upload-label'),
      fileInfo: $('file-info'),
      fileName: $('file-name'),
      fileSize: $('file-size'),
      btnRemove: $('btn-remove'),
      videoPreview: $('video-preview'),
      btnTranscribe: $('btn-transcribe'),
      processing: $('processing'),
      processText: $('process-text'),
      transcriptionText: $('transcription-text'),
      translationText: $('translation-text'),
      btnCopySrc: $('btn-copy-src'),
      btnCopyRu: $('btn-copy-ru'),
      voiceDe: $('voice-de'),
      voiceRu: $('voice-ru'),
      btnSpeakDe: $('btn-speak-de'),
      btnSpeakRu: $('btn-speak-ru'),
      iconSpeakDe: $('icon-speak-de'),
      iconSpeakRu: $('icon-speak-ru'),
      loaderDe: $('loader-de'),
      loaderRu: $('loader-ru'),
      textSpeakDe: $('text-speak-de'),
      textSpeakRu: $('text-speak-ru')
    };

    if (state.isDark) {
      document.documentElement.classList.add('dark');
      els.iconDark.classList.add('hidden');
      els.iconLight.classList.remove('hidden');
    }
    if (state.apiKey) {
      els.apiKey.value = state.apiKey;
      els.keyStatus.textContent = 'Сохранён';
      els.keyStatus.classList.add('text-emerald-500');
    }

    els.btnSaveKey.addEventListener('click', () => {
      const key = els.apiKey.value.trim();
      if (!key) {
        toast('Введите API Key', 'error');
        return;
      }
      localStorage.setItem('gemini-api-key', key);
      state.apiKey = key;
      els.keyStatus.textContent = 'Сохранён';
      els.keyStatus.classList.add('text-emerald-500');
      toast('API Key сохранён', 'success');
    });

    els.btnTheme.addEventListener('click', () => {
      state.isDark = !state.isDark;
      if (state.isDark) {
        document.documentElement.classList.add('dark');
        els.iconDark.classList.add('hidden');
        els.iconLight.classList.remove('hidden');
        localStorage.setItem('theme', 'dark');
      } else {
        document.documentElement.classList.remove('dark');
        els.iconDark.classList.remove('hidden');
        els.iconLight.classList.add('hidden');
        localStorage.setItem('theme', 'light');
      }
    });

    els.fileInput.addEventListener('change', (e) => {
      const file = e.target.files?.[0];
      if (!file) return;

      if (!file.type.startsWith('video/')) {
        toast('Пожалуйста, выберите видео файл', 'error');
        els.fileInput.value = '';
        return;
      }

      if (file.size > 20 * 1024 * 1024) {
        const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
        toast(`Файл слишком большой (${sizeMB} MB). Макс: 20 MB`, 'error');
        els.fileInput.value = '';
        return;
      }

      state.file = file;
      els.fileName.textContent = file.name;
      els.fileSize.textContent = formatBytes(file.size);
      els.videoPreview.src = URL.createObjectURL(file);

      els.uploadLabel.classList.add('hidden');
      els.fileInfo.classList.remove('hidden');
      els.fileInfo.classList.add('flex');

      resetResults();
      lucide.createIcons();
    });

    els.btnRemove.addEventListener('click', () => {
      state.file = null;
      els.fileInput.value = '';
      els.videoPreview.src = '';
      els.uploadLabel.classList.remove('hidden');
      els.fileInfo.classList.add('hidden');
      els.fileInfo.classList.remove('flex');
      els.processing.classList.add('hidden');
      els.processing.classList.remove('flex');
      resetResults();
    });

    function resetResults() {
      state.transcription = '';
      state.translation = '';

      els.transcriptionText.textContent = 'Результат появится здесь...';
      els.transcriptionText.className = 'text-sm text-slate-400 dark:text-slate-600 italic';

      els.translationText.textContent = 'Результат появится здесь...';
      els.translationText.className = 'text-sm text-slate-400 dark:text-slate-600 italic';

      els.btnCopySrc.disabled = true;
      els.btnCopyRu.disabled = true;
      els.btnSpeakDe.disabled = true;
      els.btnSpeakRu.disabled = true;
    }

    els.btnTranscribe.addEventListener('click', async () => {
      if (!state.apiKey) {
        toast('Введите API Key', 'error');
        return;
      }
      if (!state.file) {
        toast('Выберите видео', 'error');
        return;
      }

      setProcessing(true, 'Чтение файла...');

      try {
        const base64 = await fileToBase64(state.file);

        setProcessing(true, 'Транскрибация видео...');
        const transcription = await callGemini({ mode: 'transcribe', data: base64, mimeType: state.file.type });
        state.transcription = transcription;

        els.transcriptionText.textContent = transcription;
        els.transcriptionText.className = 'text-sm text-slate-700 dark:text-slate-300 whitespace-pre-wrap';
        els.btnCopySrc.disabled = false;
        els.btnSpeakDe.disabled = false;

        setProcessing(true, 'Перевод на русский...');
        const translation = await callGemini({ mode: 'translate', data: transcription, mimeType: null });
        state.translation = translation;

        els.translationText.textContent = translation;
        els.translationText.className = 'text-sm text-slate-700 dark:text-slate-300 whitespace-pre-wrap';
        els.btnCopyRu.disabled = false;
        els.btnSpeakRu.disabled = false;

        toast('Готово!', 'success');
      } catch (err) {
        console.error(err);
        toast(err?.message || 'Произошла ошибка', 'error');
      } finally {
        setProcessing(false);
      }
    });

    function setProcessing(on, text = '') {
      if (on) {
        els.uploadLabel.classList.add('hidden');
        els.fileInfo.classList.add('hidden');
        els.processing.classList.remove('hidden');
        els.processing.classList.add('flex');
        els.processText.textContent = text;
      } else {
        els.processing.classList.add('hidden');
        els.processing.classList.remove('flex');
        if (state.file) {
          els.fileInfo.classList.remove('hidden');
          els.fileInfo.classList.add('flex');
        } else {
          els.uploadLabel.classList.remove('hidden');
          els.fileInfo.classList.add('hidden');
          els.fileInfo.classList.remove('flex');
        }
      }
    }

    const GEMINI_API_BASE = 'https://generativelanguage.googleapis.com/v1';
    const GEMINI_MODEL_CANDIDATES = [
      'gemini-1.5-flash-latest',
      'gemini-1.5-pro-latest'
    ];

    async function callGemini({ data, mimeType, mode }) {
      let parts = [];
      if (mode === 'transcribe') {
        parts = [
          {
            text:
              'Transcribe all the speech from this video in German. ' +
              'Return ONLY the German text transcription, nothing else. ' +
              'No formatting, no timestamps, no explanations.'
          },
          { inlineData: { mimeType, data } }
        ];
      } else if (mode === 'translate') {
        parts = [
          {
            text:
              'Translate the following German text to Russian. ' +
              'Return ONLY the Russian translation:\n\n' +
              data
          }
        ];
      } else {
        throw new Error('Неверный режим запроса');
      }

      let lastErr = null;
      for (const model of GEMINI_MODEL_CANDIDATES) {
        try {
          const url = `${GEMINI_API_BASE}/models/${model}:generateContent?key=${encodeURIComponent(state.apiKey)}`;

          const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              contents: [{ parts }],
              safetySettings: [
                { category: 'HARM_CATEGORY_HARASSMENT', threshold: 'BLOCK_NONE' },
                { category: 'HARM_CATEGORY_HATE_SPEECH', threshold: 'BLOCK_NONE' },
                { category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT', threshold: 'BLOCK_NONE' },
                { category: 'HARM_CATEGORY_DANGEROUS_CONTENT', threshold: 'BLOCK_NONE' }
              ]
            })
          });

          if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            const apiMsg = errorData?.error?.message || response.statusText;

            if (response.status === 404 || /not found|not supported/i.test(apiMsg)) {
              lastErr = new Error(`Модель "${model}" недоступна: ${apiMsg}`);
              continue;
            }

            throw mapGeminiError(response.status, apiMsg);
          }

          const json = await response.json();
          const text = json?.candidates?.[0]?.content?.parts?.[0]?.text;

          if (!text || !text.trim()) {
            throw new Error('API вернул пустой текст');
          }

          return text.trim();
        } catch (e) {
          lastErr = e;
          const msg = String(e?.message || '');
          const isModelProblem = /Модель ".+" недоступна/i.test(msg) || /not found|not supported/i.test(msg);

          if (!isModelProblem) throw e;
        }
      }

      throw new Error(
        (lastErr?.message ? `${lastErr.message} ` : '') +
        'Попробуйте другой API-ключ/проект или включите доступ к нужным моделям в Google AI Studio.'
      );
    }

    function mapGeminiError(status, apiMsg) {
      if (status === 400) return new Error(`Ошибка API (400): ${apiMsg}. Проверьте формат файла/запрос.`);
      if (status === 401) return new Error(`Не авторизовано (401): ${apiMsg}. Проверьте API ключ.`);
      if (status === 403) return new Error(`Доступ запрещён (403): ${apiMsg}. Проверьте API ключ/проект/лимиты.`);
      if (status === 404) return new Error(`Модель/метод не найден (404): ${apiMsg}`);
      if (status === 413) return new Error(`Слишком большой запрос (413): ${apiMsg}. Попробуйте меньшее видео.`);
      if (status === 429) return new Error(`Лимит запросов (429): ${apiMsg}. Подождите и повторите.`);
      return new Error(`Ошибка API (${status}): ${apiMsg}`);
    }

    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
          try {
            const base64 = String(reader.result || '').split(',')[1];
            if (!base64) reject(new Error('Не удалось прочитать файл'));
            else resolve(base64);
          } catch {
            reject(new Error('Ошибка обработки файла'));
          }
        };
        reader.onerror = () => reject(new Error('Ошибка чтения файла'));
        reader.readAsDataURL(file);
      });
    }

    els.btnCopySrc.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(state.transcription || '');
        toast('Скопировано', 'success');
      } catch {
        toast('Не удалось скопировать текст', 'error');
      }
    });

    els.btnCopyRu.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(state.translation || '');
        toast('Скопировано', 'success');
      } catch {
        toast('Не удалось скопировать текст', 'error');
      }
    });

    async function speak(text, voice, btn, icon, loader, textEl) {
      if (!text) return;

      if (state.currentAudio) {
        state.currentAudio.pause();
        state.currentAudio = null;
      }

      if (state.isSpeaking) {
        state.isSpeaking = false;
        icon.classList.remove('hidden');
        loader.classList.add('hidden');
        textEl.textContent = textEl.dataset.original || textEl.textContent;
        return;
      }

      state.isSpeaking = true;
      icon.classList.add('hidden');
      loader.classList.remove('hidden');
      textEl.dataset.original = textEl.textContent;
      textEl.textContent = 'Генерация...';

      try {
        const url = `https://api.streamelements.com/kappa/v2/speech?voice=${encodeURIComponent(voice)}&text=${encodeURIComponent(text)}`;
        const audio = new Audio(url);
        state.currentAudio = audio;

        audio.oncanplay = () => { textEl.textContent = 'Воспроизведение...'; };

        audio.onended = () => {
          state.isSpeaking = false;
          icon.classList.remove('hidden');
          loader.classList.add('hidden');
          textEl.textContent = textEl.dataset.original || 'Озвучить';
          state.currentAudio = null;
        };

        audio.onerror = () => {
          toast('Ошибка озвучки', 'error');
          state.isSpeaking = false;
          icon.classList.remove('hidden');
          loader.classList.add('hidden');
          textEl.textContent = textEl.dataset.original || 'Озвучить';
          state.currentAudio = null;
        };

        await audio.play();
      } catch {
        toast('Ошибка озвучки', 'error');
        state.isSpeaking = false;
        icon.classList.remove('hidden');
        loader.classList.add('hidden');
        textEl.textContent = textEl.dataset.original || 'Озвучить';
      }
    }

    els.btnSpeakDe.addEventListener('click', () => {
      speak(state.transcription, els.voiceDe.value, els.btnSpeakDe, els.iconSpeakDe, els.loaderDe, els.textSpeakDe);
    });

    els.btnSpeakRu.addEventListener('click', () => {
      speak(state.translation, els.voiceRu.value, els.btnSpeakRu, els.iconSpeakRu, els.loaderRu, els.textSpeakRu);
    });

    function formatBytes(bytes) {
      if (bytes === 0) return '0 B';
      const k = 1024;
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return (bytes / Math.pow(k, i)).toFixed(2) + ' ' + ['B', 'KB', 'MB', 'GB'][i];
    }

    function toast(msg, type = 'info') {
      const div = document.createElement('div');
      div.className =
        `fixed bottom-4 right-4 px-4 py-3 rounded-lg shadow-lg text-white text-sm font-medium z-50 ` +
        (type === 'error' ? 'bg-rose-500' : type === 'success' ? 'bg-emerald-500' : 'bg-indigo-500');
      div.textContent = msg;
      document.body.appendChild(div);

      setTimeout(() => {
        div.style.opacity = '0';
        div.style.transition = 'opacity 300ms';
        setTimeout(() => div.remove(), 300);
      }, 3000);
    }
  </script>
</body>
</html>
